pipeline {
    agent any
    environment {
        DOCKERHUB_USERNAME = credentials('dockerhub_username')
        DOCKERHUB_PASSWORD = credentials('dockerhub_password')
    }
    stages {
        stage('Download Artifactory') {
            steps {
                rtDownload (
                    serverId:"ArtifactoryJfrog",
                    spec: '''{
                         "files": [
                             {
                                 "pattern": "spring-calculator",
                                 "target": "./"
                             }
                         ]
                    }''',
                )
            }
        }
        stage('Build Docker Image and Publish on Dockerhub') {
            steps {
                sh "packer build -var 'dockerhub_username=$DOCKERHUB_USERNAME' -var 'dockerhub_password=$DOCKERHUB_PASSWORD' infra/job2/packer_template.json"
            }
        }
    }
}